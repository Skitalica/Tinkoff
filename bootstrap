Бутстрап
Что это?
Бутстрап – это метод повторной выборки, который позволяет эмпирически оценить распределение статистики (например, разницы средних или медиан) без предположения о нормальности исходных данных.

Как применяется?
При бутстрапе из исходных выборок (контрольной и тестовой) многократно (например, 10 000 раз) создаются новые выборки (с заменой). Для каждой такой бутстрап-выборки рассчитывается интересующая метрика (например, разница ARPU между группами). По результатам повторных выборок строятся эмпирические распределения, из которых можно извлечь доверительные интервалы и оценить p-value.

Плюсы:

Гибкость: не требует предположений о виде распределения (важно, что данные репрезентативны).
Оценка доверительных интервалов: позволяет получить не только p-value, но и интервал, показывающий величину эффекта.
Подходит для сложных метрик: если ARPU вычисляется по сложной формуле или включает медиану, бутстрап позволяет оценить неопределённость.
Минусы:

Вычислительно затратный: требует многократного повторного расчёта метрик (хотя современные компьютеры справляются даже с большими выборками).
Интерпретация: результаты бутстрапа (например, распределение разницы ARPU) требуют определённого опыта для правильной интерпретации.
Критерий Манна–Уитни
Что это?
Манна–Уитни (также известный как U-тест или ранговый тест Вилкоксона) – непараметрический тест, который сравнивает два независимых набора данных по их ранговым значениям. Он оценивает, насколько одна выборка имеет тенденцию давать более высокие или более низкие значения по сравнению с другой.

Как применяется?
Тест не требует предположения о нормальности и чувствителен к порядку значений, а не к их абсолютным величинам. Он выдаёт p-value, которое показывает, можно ли отвергнуть нулевую гипотезу о равенстве распределений между контрольной и тестовой группой.

Плюсы:

Простота: достаточно понятен и широко используется для сравнения медиан или распределений.
Непараметрический: не требует нормальности данных и устойчив к выбросам.
Фокус на ранговых различиях: полезен, если важно знать, какая группа «перебивает» другую по порядку значений.
Минусы:

Ограниченная информация: тест Манна–Уитни предоставляет только p-value и не оценивает величину эффекта (разницу ARPU) напрямую – для этого нужно дополнительно рассчитывать меры эффекта.
Интерпретация: результат говорит о том, что распределения различаются (например, медианы отличаются), но не даёт уверенности в разнице средних значений, которая может быть важна для ARPU.
Сравнение и интерпретация для ARPU
Бутстрап:
Позволяет получить эмпирическое распределение разницы ARPU между группами, построить доверительный интервал и оценить, насколько эффект (например, увеличение ARPU в тестовой группе) отличается от нуля. Это особенно важно при асимметричных распределениях, где простое сравнение средних может быть неинформативным. Результаты бутстрапа можно интерпретировать так: «С 95% доверием разница ARPU между группами лежит в интервале от X до Y, что говорит о статистически значимом эффекте, если 0 не входит в этот интервал».

Манна–Уитни:
Фокусируется на том, имеет ли тестовая группа тенденцию давать более высокие (или более низкие) значения ARPU по сравнению с контрольной, оценивая ранговые различия. Результат теста может быть интерпретирован следующим образом: «Согласно Манна–Уитни тесту, распределения ARPU в тестовой и контрольной группах статистически различаются (p < 0.05), что свидетельствует о том, что пользователи тестовой группы, как правило, генерируют более высокие (или более низкие) значения ARPU, чем пользователи контрольной группы.»

Итоговое пояснение заказчику
Бутстрап:
«Мы используем бутстрап, чтобы оценить, насколько изменился средний доход на пользователя (ARPU) между группами, и получить диапазон, в котором с высокой вероятностью находится истинная разница. Этот метод позволяет нам учесть несимметричность и выбросы в данных, что характерно для ARPU.»

Манна–Уитни:
«Мы применяем тест Манна–Уитни, чтобы проверить, отличается ли порядок значений ARPU между группами. То есть, насколько часто пользователи из тестовой группы генерируют более высокие доходы, чем пользователи из контрольной группы. Если тест показывает значимость, это означает, что распределения ARPU различаются, что может быть вызвано изменениями в продукте или процессе.»

Оба метода дополняют друг друга: бутстрап даёт количественную оценку разницы и её доверительный интервал, а Манна–Уитни – качественное подтверждение различия в распределениях. Выбор конкретного метода зависит от целей анализа и особенностей данных.







Вы сказали:
как на питоне провести ab на метрике arpu бутстрапом
ChatGPT

Рассуждала для 6 секунд
Ниже приведён пример того, как можно провести A/B‑тест по метрике ARPU с использованием бутстрапа в Python. Идея метода в том, что мы многократно (например, 10 000 раз) создаём подвыборки с заменой для контрольной и тестовой групп, вычисляем ARPU для каждой подвыборки и затем оцениваем эмпирическое распределение разницы ARPU между группами. По этому распределению можно построить 95% доверительный интервал разницы и определить, статистически ли значима разница (если интервал не содержит 0).

Пример кода
python
Копировать
Редактировать
import numpy as np

# Симулируем данные для примера:
# Допустим, ARPU рассчитывается как средний доход на пользователя.
# Здесь мы используем распределение Гамма для имитации асимметричных данных.
np.random.seed(42)
control = np.random.gamma(shape=2, scale=50, size=500)   # контрольная группа
test = np.random.gamma(shape=2.2, scale=50, size=500)      # тестовая группа

def bootstrap_arpu(control, test, n_bootstrap=10000):
    """
    Функция проводит бутстрап для вычисления разницы ARPU (среднего дохода)
    между тестовой и контрольной группой.
    
    :param control: массив данных ARPU для контрольной группы
    :param test: массив данных ARPU для тестовой группы
    :param n_bootstrap: количество бутстрап-итераций
    :return: массив разниц ARPU (test - control) по каждой итерации
    """
    boot_diffs = np.empty(n_bootstrap)
    n_control = len(control)
    n_test = len(test)
    
    for i in range(n_bootstrap):
        # Случайная выборка с заменой для каждой группы
        sample_control = np.random.choice(control, size=n_control, replace=True)
        sample_test = np.random.choice(test, size=n_test, replace=True)
        # Вычисляем разницу средних значений (ARPU)
        boot_diffs[i] = np.mean(sample_test) - np.mean(sample_control)
    
    return boot_diffs

# Запускаем бутстрап
boot_diffs = bootstrap_arpu(control, test, n_bootstrap=10000)

# Вычисляем 95% доверительный интервал для разницы ARPU
ci_lower = np.percentile(boot_diffs, 2.5)
ci_upper = np.percentile(boot_diffs, 97.5)

print("95% доверительный интервал разницы ARPU: [{:.2f}, {:.2f}]".format(ci_lower, ci_upper))

# Интерпретация:
# Если доверительный интервал не содержит ноль, можно считать, что разница статистически значима.
if ci_lower > 0 or ci_upper < 0:
    print("Разница между группами статистически значима.")
else:
    print("Нет статистически значимой разницы между группами.")
Объяснение работы кода
Симуляция данных:
Здесь для примера создаются два массива (control и test), имитирующие значения ARPU для контрольной и тестовой групп. Используется распределение Гамма, которое характерно для доходов (асимметричное распределение с длинным хвостом).

Функция bootstrap_arpu:

В цикле n_bootstrap раз выбираются случайные подвыборки из каждой группы (с заменой).
Для каждой итерации рассчитываются средние значения для тестовой и контрольной групп, и вычисляется их разница.
Результат каждой итерации сохраняется в массив boot_diffs.
Доверительный интервал:

С помощью функции np.percentile вычисляем 2.5-й и 97.5-й перцентили из распределения разницы ARPU.
Если этот интервал не содержит ноль, то разница между группами считается статистически значимой.
Интерпретация для заказчика:
«Мы провели бутстрап-оценку разницы ARPU между тестовой и контрольной группами. Полученный 95%-й доверительный интервал показывает диапазон, в котором с 95%-ной уверенностью находится истинная разница. Если интервал не включает 0, это означает, что разница значима и изменение в тестовой группе, скорее всего, действительно повлияло на ARPU.»

Таким образом, метод бутстрапа позволяет нам получить надежную оценку разницы метрик даже при отсутствии нормальности распределения, что часто имеет место при анализе ARPU.
